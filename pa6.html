<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>PA6: D3 Visual Animation</title>

    <style type="text/css">
      #control-buttons{
        width: 800px;
        height: 40px;
        text-align: center;
      }
    </style>

    <script src="d3.min.js" charset="utf-8"></script>
    <script src="animation.js" charset="utf-8"></script>
    <script>
    /* We build user-specific animations here. */

    // MarqueeAnimation is an animation that causes columns to alternate 
    var MarqueeAnimation = Animation.make({color: "blue", delay: 800, duration: 400});
    MarqueeAnimation.prototype.play = function() {
      // This sequence is a off-to-on transition
      function zigLow(selection, params) {
        selection.attr("fill", "white")
          .transition()
          .delay(params.delay)
          .attr("fill", params.color)
          .duration(params.duration)
          .delay(params.delay)
          .each("end", function() {zigHigh(selection, params)});
      }

      // This sequence is an on-to-off transition
      function zigHigh(selection, params) {
        selection.attr("fill", params.color)
          .transition()
          .delay(params.delay)
          .attr("fill", "white")
          .duration(params.duration)
          .delay(params.delay)
          .each("end", function() {zigLow(selection, params)});
      }

      // Make half of the lights start on, half start off
      zigLow(this.selection.filter(function(d, i) { return i % 2; }), this.params);
      zigHigh(this.selection.filter(function(d, i) { return !(i % 2); }), this.params);
    }

    /* Driver code below */
    var leds;
    var marqueeAnim;

    // Setup method called after body loads.
    function setup() {
      leds = d3.selectAll(".led");
      marqueeAnim = new MarqueeAnimation(leds);
      chimeCount = 0;
    }

    function reset() {
      marqueeAnim.stop();
      marqueeAnim.resetParams();
      chimeCount = 0;
    }

    // This button starts or stops the animation.
    function startClicked(){
      button = document.getElementById("start-reset");
      switch(button.innerHTML){
          case "Start":
          button.innerHTML = "Reset";
          marqueeAnim.play();
          break;
        case "Reset":
          button.innerHTML = "Start";
          reset();
          break;
      }
    }

    // Reacting to user events. In our example, the animation either changes speeds or color
    // depending on the number of times "Chime" has been clicked. 
    function chimeCliked(){
      switch (chimeCount) {
        case 0: marqueeAnim.params.delay = 200; break;
        case 1: marqueeAnim.params.color = "green"; break;
        case 2: marqueeAnim.params.delay = 800; break;
        case 3: marqueeAnim.params.color = "blue"; break;
      }
      chimeCount = (chimeCount + 1) % 4;
    }

    /*function MarqueeAnimation(selection) {
      this.selection = selection;
      this.params = {color: "blue", delay: 800, duration: 400};
    }

    MarqueeAnimation.prototype.play = function() {
      function zigLow(selection, params) {
        selection.attr("fill", "white")
          .transition()
          .delay(params.delay)
          .attr("fill", params.color)
          .duration(params.duration)
          .delay(params.delay)
          .each("end", function() {zigHigh(selection, params)});
      }

      function zigHigh(selection, params) {
        selection.attr("fill", params.color)
          .transition()
          .delay(params.delay)
          .attr("fill", "white")
          .duration(params.duration)
          .delay(params.delay)
          .each("end", function() {zigLow(selection, params)});
      }

      zigLow(this.selection.filter(function(d, i) { return i % 2; }), this.params);
      zigHigh(this.selection.filter(function(d, i) { return !(i % 2); }), this.params);
    }

    MarqueeAnimation.prototype.getParams = function(){
      return this.params;
    }

    MarqueeAnimation.prototype.setParams = function(params) {
      this.params = params;
    }

    MarqueeAnimation.prototype.stop = function() {*/
      

    /*function marqueeSequence(color, timeSteps){
      var LEDs = d3.selectAll(".led");
      var i = 0;                    
      function marqueeLoop() {         
         setTimeout(function () {    
            LEDs.each(function(d, j){
                var currentCircle = d3.select(this);
                console.log(this);
                if(i % 2 == 0){
                  if(j % 2 == 0){
                    currentCircle.attr("fill", color);
                  } else{
                    currentCircle.attr("fill", "white");
                  }
                } else {
                  if(j % 2 == 0){
                    currentCircle.attr("fill", "white");
                  } else {
                    currentCircle.attr("fill", color);
                  }
                }
            });           
            i++;                     
            if (i < timeSteps) {           
               marqueeLoop();             
            }                      
         }, 500)
      }
      marqueeLoop(); 
    }*/
  </script>
  </head>
  <body onload="setup()">
    <svg width="800" height="400" boarder="1">
      <rect id="stage" x="0" y="0" width="800" height="400" stroke="black" stroke-width="1" fill-opacity="0.0"/>
        <circle class="led" id="led1" cx="50" cy="50" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led2" cx="150" cy="50" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led3" cx="250" cy="50" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led4" cx="350" cy="50" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led5" cx="450" cy="50" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led6" cx="550" cy="50" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led7" cx="650" cy="50" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led8" cx="750" cy="50" r="40" stroke="black" stroke-width="1" fill="white"/>

        <circle class="led" id="led9" cx="50" cy="150" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led10"  cx="150" cy="150" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led11"  cx="250" cy="150" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led12"  cx="350" cy="150" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led13"  cx="450" cy="150" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led14"  cx="550" cy="150" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led15"  cx="650" cy="150" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led16"  cx="750" cy="150" r="40" stroke="black" stroke-width="1" fill="white"/>

        <circle class="led" id="led17"  cx="50" cy="250" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led18"  cx="150" cy="250" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led19"  cx="250" cy="250" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led20"  cx="350" cy="250" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led21"  cx="450" cy="250" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led22"  cx="550" cy="250" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led23"  cx="650" cy="250" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led24"  cx="750" cy="250" r="40" stroke="black" stroke-width="1" fill="white"/>

        <circle class="led" id="led25"  cx="50" cy="350" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led26"  cx="150" cy="350" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led27"  cx="250" cy="350" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led28"  cx="350" cy="350" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led29"  cx="450" cy="350" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led30"  cx="550" cy="350" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led31"  cx="650" cy="350" r="40" stroke="black" stroke-width="1" fill="white"/>
        <circle class="led" id="led32"  cx="750" cy="350" r="40" stroke="black" stroke-width="1" fill="white"/>
    </svg>
    </br>
    <div id="control-buttons">
      <button id="start-reset" type="button" onclick="startClicked()">Start</button>
      <button id="chime" type="button" onclick="chimeCliked()">Chime</button>
    </div>
  </body>
</html>